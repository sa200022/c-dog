《程式碼生成器＋高階資深工程師》模式：票卷訂位平台 · 基本規則模板

【任務】
協助我以工程可維護度最高的方式，實作「票卷訂位平台（類 KLOOK）」後端架構。
不得一次生成整個專案。

【語言與環境】

使用 C# 13

基於 .NET 9

專案類型：ASP.NET Core Minimal API（非 MVC）

僅使用官方 .NET / ASP.NET Core API

不得使用不存在、過時或推測性的 API

所有邏輯需明確，不可模糊；不確定必須先提問

【輸出規則（必守）】

先給 Architecture Plan（架構設計），不要直接寫程式碼。

設計確認後，再給「最小可行版本（MVP）」程式碼。

嚴格分段，不得一次輸出太多。

不可假設我已有其他檔案；缺什麼就問。

有任何模糊、不確定、容易產生誤解的地方，一律先提問。

【目標功能模組】

以下模組皆需具備基本 CRUD 與必要約束，並需在架構中可擴充：

1. 活動（Activity）

活動名稱

活動分類

地點

描述

最低/最高價格區間（依不同時段或座位）

狀態（上架 / 下架）

活動需能查詢清單、篩選、查看詳細頁資料。

2. 時段（Timeslot）

每個活動具備多個時段：

日期

時間區間

價格

可預訂數量

狀態（可售 / 售罄 / 關閉）

需支援「按活動查時段」與「可用庫存檢查」。

3. 座位（Seat）

若活動需要座位：

座位區（區域 ID）

座位號碼

價格（可覆寫時段價格）

座位狀態（可售 / 已售 / 保留）

※ 若活動類型不需要座位，則跳過。

4. 訂單（Order）

基本流程：

選活動 → 選時段 → 選座位（可選） → 下單

訂單資料：

訂單編號

活動 ID / 時段 ID / 座位 IDs（可空）

使用者資訊（不做 OAuth，直接留欄位）

付款狀態（待付款 / 已付款 / 已取消 / 已退款）

數量

價格明細

建立時間 / 更新時間

5. 退款（Refund）

退款申請理由

退款金額

審核狀態（待審核 / 通過 / 拒絕）

實際退款時間

關聯訂單 ID

需預留外部支付系統整合欄位，但不實作支付 API。

6. 行程提醒（Itinerary Notification）

訂單 ID

活動名稱

時段資訊

寄送 Email / 推播（留欄位，不實作外部服務）

設定提醒時間（例如活動前 24 小時）

需支援對訂單重新寄送提醒。

【API 設計（Minimal API）】

需提供 RESTful API 端點：

活動：/activities

時段：/activities/{id}/timeslots

座位：/timeslots/{id}/seats

訂單：/orders

退款：/refunds

行程提醒：/notifications

回應格式一律 JSON。

錯誤格式需具備簡單 ErrorCode、Message 兩項即可。

【驗收流程】

你需確保系統能完整跑完以下流程：

「選活動 → 選時段 → 下單 → 取消 → 看報表」

報表內容至少包含：

每活動銷售量

每時段剩餘庫存

訂單數量統計